@page "/Profile/Account/ChangePassword"
@using Application.User.Users.CommandAndQueries
@using Bit.BlazorUI
@using MyShop.Ui.Client.Commen.Controles.Inputs
@using MyShop.Ui.Client.Commen.Notifications  
@layout ProfileLayout
     @rendermode InteractiveWebAssembly
<SnackBar @ref="SnackBar"/>

<MudContainer Class="col-12">
    @* Section title *@
    <MudText Typo="Typo.h6" Class="section-title mb-2">
        اطلاعات شخصی
    </MudText>

    <MudPaper Class="shadow-around p-3"> @* Replaces <section> with MudPaper for a cleaner look *@
        <EditForm Model="Command" OnValidSubmit="OnValidSubmit"  FormName="ChangePassWord">     
            <AntiforgeryToken/>
            <MudGrid Gutter="true"> @* Replaces <div class="row"> with MudGrid *@
                @* Current password field *@
                <MudItem xs="12" lg="12" Class="mb-5">
                    <MudTextField T="string"
                                  Label="رمز عبور فعلی:"
                                  @bind-Value="Command.CurrentPassword"
                                  Variant="Variant.Outlined"
                                  Class="w-100"/> @* Ensures full-width with Class="w-100" *@
                </MudItem>

                @* New password field *@
                <MudItem xs="12" lg="6" Class="mb-5">
                    <MudTextField T="string"
                                  Label="رمز عبور جدید:"
                                  @bind-Value="Command.Password"
                                  Variant="Variant.Outlined"
                                  Class="w-100"/>
                </MudItem>

                @* Confirm password field *@
                <MudItem xs="12" lg="6" Class="mb-5">
                    <MudTextField T="string"
                                  Label="تایید رمز عبور:"
                                  @bind-Value="Command.ConfirmPassword"
                                  Variant="Variant.Outlined"
                                  Class="w-100"/>
                </MudItem>

                @* Submit button *@
                <MudItem xs="12">
                    <MudButton Color="Color.Primary"
                               Variant="Variant.Filled"
                               EndIcon="@Icons.Material.Filled.Edit"
                               ButtonType="ButtonType.Submit"
                               Class="text-left">
                        ذخیره تغییرات
                    </MudButton>
                </MudItem>

            </MudGrid>
        </EditForm>
    </MudPaper>
</MudContainer>


@code{

    [SupplyParameterFromForm(FormName = "ChangePassWord")]
    public ChangePasswordCommand Command { get; set; } = new();
private SnackBar? SnackBar { get; set; }

private async Task OnValidSubmit(EditContext obj)
    {
        try
        {
            var result =await UserService.ChangePassword(Command);

            if(!result.IsSuccess)
                await ShowDialog("خطا", result.MetaData.Message);

            await SnackBar!.ShowSnackBar("موفقیت", "رمز عبور شما با موفقیت تغیر یافت.", BitSnackBarType.Success);
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }


    private async Task ShowDialog(string title , string message)
    {
        await DialogService.ShowMessageBox(
            title,
            message,
            yesText: "بستن" );
        StateHasChanged();
    }
}